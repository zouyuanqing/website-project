# 信息收集系统 - 支付功能使用指南

## 🎯 功能概述

本系统已成功集成支付到管理员指定账户的功能，支持微信支付、支付宝支付和银行卡收款。

## 🚀 快速开始

### 1. 演示账户
- **管理员账户**: admin@demo.com / admin123
- **测试用户**: user@demo.com / user123

### 2. 访问地址
- 系统首页: http://127.0.0.1:5000
- 管理员登录: http://127.0.0.1:5000/admin/login
- 用户登录: http://127.0.0.1:5000/login

## 📋 功能使用流程

### 管理员操作

#### 第一步：配置收款账户
1. 使用管理员账户登录系统
2. 进入"收款账户管理"
3. 添加收款账户（微信/支付宝/银行卡）
4. 设置账户信息（账户名称、账号、收款人等）

#### 第二步：创建支付表单
1. 进入"表单管理" → "创建表单"
2. 填写表单基本信息
3. 添加表单字段，选择"微信支付"或"支付宝支付"
4. 为支付字段选择对应的收款账户
5. 保存并发布表单

### 用户操作

#### 填写表单并支付
1. 使用用户账户登录系统
2. 查看"可用表单"，选择包含支付字段的表单
3. 填写表单信息，输入支付金额
4. 提交表单后自动跳转到支付页面
5. 查看收款账户信息，完成支付
6. 查看支付成功页面和支付凭证

## 💡 主要特性

### ✅ 收款账户管理
- 支持三种账户类型：微信、支付宝、银行卡
- 完整的账户信息管理（账户名、账号、收款人、银行信息）
- 账户启用/禁用状态控制
- 安全的账号显示（部分掩码）

### ✅ 支付流程优化
- 用户支付时清楚显示收款账户信息
- 完整的支付订单管理和状态跟踪
- 支付成功后显示详细凭证信息
- 支持支付订单状态管理（待支付、已支付、失败、取消）

### ✅ 表单字段关联
- 支付字段与收款账户一对一关联
- 表单创建时可选择特定收款账户
- 灵活的支付金额设置（用户自定义输入）

### ✅ 管理员功能
- 支付订单统计和管理
- 收入统计（总收入、微信收入、支付宝收入）
- 支付状态手动更新
- 导出功能支持

## 🔧 技术特性

- **数据库设计**: 完整的关联关系设计
- **安全性**: 账号信息掩码显示，密码加密存储
- **用户体验**: 美观的支付界面，清晰的信息展示
- **扩展性**: 易于添加新的支付方式和收款账户类型

## 📊 系统架构

```
用户填写表单 → 包含支付字段 → 关联收款账户 → 生成支付订单 → 显示收款信息 → 完成支付 → 更新订单状态
```

## 🛠️ 开发说明

### 核心文件
- `models.py`: 数据模型（PaymentOrder, PaymentAccount）
- `app.py`: 路由和业务逻辑
- `templates/user/payment.html`: 支付页面
- `templates/admin/payment_accounts.html`: 收款账户管理

### 数据库表
- `payment_order`: 支付订单表
- `payment_account`: 收款账户表
- `form_field`: 表单字段表（增加payment_account_id关联）

## 🎉 演示建议

1. **管理员演示**:
   - 登录管理后台查看收款账户
   - 创建包含支付字段的测试表单
   - 查看支付订单管理界面

2. **用户演示**:
   - 填写支付表单
   - 查看支付页面的收款账户信息
   - 完成模拟支付查看成功页面

3. **功能展示**:
   - 不同类型收款账户的信息展示
   - 支付订单状态管理
   - 收入统计和报表功能

## ⚠️ 注意事项

- 当前为演示版本，支付为模拟处理
- 生产环境需要集成真实的支付接口
- 建议定期备份数据库
- 收款账户信息需要妥善保管